  - name: Discover all existing virtual machines on node
    community.general.proxmox_vm_info:
      api_host: "{{ secrets_cfg.proxmox.api_host | default(omit) }}"
      api_user: "{{ secrets_cfg.proxmox.api_user | default(omit) }}"
      api_token_id: "{{ secrets_cfg.proxmox.api_token_id | default(omit) }}"
      api_token_secret: "{{ secrets_cfg.proxmox.api_token_secret | default(omit) }}"
      node: "{{ secrets_cfg.proxmox.node }}"
    register: fah_q

  - name: show us fah_q
    debug:
      msg: "FAH-Q {{ item }} ||| {{ item.name }}"
    loop: "{{ fah_q.proxmox_vms }}"

  - name: Discover / Collect Proxmox VMs
    set_fact:
      collected_proxmox_vms: "{{ collected_proxmox_vms | combine({item.name: True}) }}"
    loop: "{{ fah_q.proxmox_vms }}"
    when: not item.template
