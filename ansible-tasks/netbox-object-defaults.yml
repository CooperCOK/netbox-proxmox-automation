  - name: Setup tenant from default value
    netbox.netbox.netbox_tenant:
      netbox_url: "{{ secrets_cfg.netbox.api_proto }}://{{ secrets_cfg.netbox.api_host }}:{{ secrets_cfg.netbox.api_port}}"
      netbox_token: "{{ secrets_cfg.netbox.api_token }}"
      data:
        name: "{{ proxmox_vm_cfg.default_tenant }}"
      state: present
    when: proxmox_vm_cfg.default_tenant is defined

  - name: Setup site group from default value
    netbox.netbox.netbox_site_group:
      netbox_url: "{{ secrets_cfg.netbox.api_proto }}://{{ secrets_cfg.netbox.api_host }}:{{ secrets_cfg.netbox.api_port}}"
      netbox_token: "{{ secrets_cfg.netbox.api_token }}"
      data:
        name: "{{ proxmox_vm_cfg.default_site_group }}"
      state: present
    when: proxmox_vm_cfg.default_site_group is defined

  - name: Create region from default value
    netbox.netbox.netbox_region:
      netbox_url: "{{ secrets_cfg.netbox.api_proto }}://{{ secrets_cfg.netbox.api_host }}:{{ secrets_cfg.netbox.api_port}}"
      netbox_token: "{{ secrets_cfg.netbox.api_token }}"
      data:
        name: "{{ proxmox_vm_cfg.default_region }}"
      state: present
    when: proxmox_vm_cfg.default_region is defined

  - name: Create site from default value
    netbox.netbox.netbox_site:
      netbox_url: "{{ secrets_cfg.netbox.api_proto }}://{{ secrets_cfg.netbox.api_host }}:{{ secrets_cfg.netbox.api_port}}"
      netbox_token: "{{ secrets_cfg.netbox.api_token }}"
      data:
        name: "{{ proxmox_vm_cfg.default_site }}"
        status: Active
        region: "{{ proxmox_vm_cfg.default_region }}"
        site_group: "{{ proxmox_vm_cfg.default_site_group }}"
        tenant: "{{ proxmox_vm_cfg.default_tenant }}"
        facility: "{{ proxmox_vm_cfg.default_facility }}"
        time_zone: "{{ proxmox_vm_cfg.default_timezone }}"
        #slug: test-california
      state: present
    when: proxmox_vm_cfg.default_tenant is defined and proxmox_vm_cfg.default_site_group is defined and proxmox_vm_cfg.default_region is defined and proxmox_vm_cfg.default_site is defined
