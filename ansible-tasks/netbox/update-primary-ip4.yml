  - name: Update VM(s) primary_ip4 in NetBox (PREFIX)
    netbox.netbox.netbox_virtual_machine:
      netbox_url: "{{ secrets_cfg.netbox.api_proto }}://{{ secrets_cfg.netbox.api_host }}:{{ secrets_cfg.netbox.api_port}}"
      netbox_token: "{{ secrets_cfg.netbox.api_token }}"
      data:
      # 'assigned_object': {'virtual_machine': 'f1'
        #name: "{{ item['item']['name'] }}"
        name: "{{ item['invocation']['module_args']['data']['assigned_object']['virtual_machine'] }}"
        primary_ip4: "{{ item['ip_address']['display'] }}"
      state: present
    loop: "{{ interface_new_ip_prefix_status.results }}"
    #when: item.changed and proxmox_all_vm_interfaces[item['invocation']['module_args']['data']['assigned_object']['name']].primary
    when: item.changed
    register: vm_update_primary_ip4_prefix

  - name: Update VM(s) primary_ip4 in NetBox (STATIC IP)
    netbox.netbox.netbox_virtual_machine:
      netbox_url: "{{ secrets_cfg.netbox.api_proto }}://{{ secrets_cfg.netbox.api_host }}:{{ secrets_cfg.netbox.api_port}}"
      netbox_token: "{{ secrets_cfg.netbox.api_token }}"
      data:
      # 'assigned_object': {'virtual_machine': 'f1'
        #name: "{{ item['item']['name'] }}"
        name: "{{ item['invocation']['module_args']['data']['assigned_object']['virtual_machine'] }}"
        primary_ip4: "{{ item['ip_address']['display'] }}"
      state: present
    loop: "{{ interface_new_ip_static_status.results }}"
    #when: item.changed and proxmox_all_vm_interfaces[item['invocation']['module_args']['data']['assigned_object']['name']].primary
    when: item.changed
    register: vm_update_primary_ip4_static

  - name: VM(s) update primary_ip4 status
    debug:
      msg: "VM(s) update primary_ip4 status {{ vm_update_primary_ip4_prefix }} {{ vm_update_primary_ip4_static }}"    
