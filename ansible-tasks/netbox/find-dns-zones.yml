  - name: Find DNS zones in Netbox
    local_action:
      module: uri
      url: "{{ secrets_cfg.netbox.api_proto }}://{{ secrets_cfg.netbox.api_host }}:{{ secrets_cfg.netbox.api_port}}/api/plugins/netbox-dns/zones/?active=true"
      method: GET
      headers:
        Authorization: "Token {{ secrets_cfg.netbox.api_token }}"
        Accept: application/json
        Content-Type: application/json
      status_code: 200
      validate_certs: no
    register: dns_zones

  - name: Collect DNS zones from NetBox dns plugin
    set_fact:
      nb_dns_plugin_zn: "{{ nb_dns_plugin_zn | combine({item.name: { 'zone_id': item.id, 'tenant_id': item.tenant.id | default(0) } }) }}"
    with_items: "{{ dns_zones.json.results }}"
